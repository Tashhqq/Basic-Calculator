<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Calculadora - Interfaz llamativa</title>
<style>
    :root{
        --bg1:#0f1724; --bg2:#071126;
        --card:#0b1220aa; --glass: rgba(255,255,255,0.06);
        --accent1:#7c5cff; --accent2:#00d4ff;
        --text:#e6eef8;
    }
    *{box-sizing:border-box;font-family:Inter,Segoe UI,system-ui,-apple-system,Roboto,"Helvetica Neue",Arial}
    body{
        margin:0; min-height:100vh;
        background: radial-gradient(600px 600px at 10% 20%, #07203a 0%, transparent 10%),
                                radial-gradient(600px 600px at 90% 80%, #1a0536 0%, transparent 12%),
                                linear-gradient(180deg,var(--bg1),var(--bg2));
        color:var(--text); display:flex; align-items:center; justify-content:center;
        padding:32px;
    }

    .container{
        width:380px; max-width:95%;
        background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
        border-radius:20px; padding:18px; box-shadow: 0 10px 30px rgba(2,6,23,0.6);
        border:1px solid rgba(255,255,255,0.03); backdrop-filter: blur(6px);
    }

    .header{
        display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:12px;
    }
    .brand{
        display:flex; gap:12px; align-items:center;
    }
    .logo{
        width:44px; height:44px; border-radius:10px;
        background:linear-gradient(135deg,var(--accent1),var(--accent2));
        display:flex; align-items:center; justify-content:center; font-weight:700; color:white;
        box-shadow:0 6px 18px rgba(124,92,255,0.28), inset 0 -6px 16px rgba(0,0,0,0.18);
    }
    .title{font-size:14px; line-height:1; }
    .subtitle{font-size:11px; color:rgba(230,238,248,0.7); margin-top:2px}

    .controls{display:flex; gap:8px; align-items:center;}
    .btn{
        background:var(--glass); padding:8px 10px; border-radius:10px; color:var(--text); font-size:13px;
        border:1px solid rgba(255,255,255,0.03); cursor:pointer; transition:transform .12s ease, box-shadow .12s;
    }
    .btn:active{transform:translateY(1px)}
    .btn.secondary{background:transparent; border:1px dashed rgba(255,255,255,0.04)}

    /* Display */
    .display{
        background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
        border-radius:14px; padding:14px; margin-bottom:16px;
        box-shadow: inset 0 -6px 16px rgba(0,0,0,0.18);
    }
    .small{
        color:rgba(230,238,248,0.6); font-size:13px; min-height:18px;
        display:flex; align-items:center; gap:8px;
    }
    .expr{font-size:14px; color:rgba(230,238,248,0.55); min-height:18px; text-align:right; word-break:break-all;}
    .result{font-size:28px; font-weight:600; text-align:right; margin-top:6px; letter-spacing:0.4px;}

    /* keypad */
    .keys{display:grid; grid-template-columns:repeat(4,1fr); gap:10px;}
    button.key{
        padding:16px; font-size:18px; border-radius:12px; border:0; cursor:pointer;
        background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
        color:var(--text); box-shadow: 0 6px 14px rgba(2,6,23,0.55);
        transition:transform .08s, box-shadow .08s, background .12s;
    }
    button.key.operator{ background:linear-gradient(180deg, rgba(124,92,255,0.14), rgba(0,0,0,0.06)); }
    button.key.equal{
        background:linear-gradient(90deg,var(--accent1),var(--accent2)); color:white; grid-column:span 2;
    }
    button.key:active{ transform:translateY(2px); box-shadow:0 4px 8px rgba(0,0,0,0.35) }

    .mini{
        display:flex; gap:8px; margin-top:12px; align-items:center; justify-content:space-between;
    }
    .history{
        max-height:120px; overflow:auto; padding:8px; background:rgba(255,255,255,0.02); border-radius:10px;
        font-size:13px; margin-top:10px;
    }
    .history-item{ padding:6px 8px; border-radius:8px; color:rgba(230,238,248,0.9); display:flex; justify-content:space-between; gap:8px}
    .history-item small{ color:rgba(230,238,248,0.6) }
    .hint{font-size:12px; color:rgba(230,238,248,0.5)}
    .mem-ind{ font-size:12px; color:var(--accent2); font-weight:600 }
    /* responsive */
    @media (max-width:420px){ .result{font-size:22px} .logo{width:40px;height:40px} }
</style>
</head>
<body>
    <div class="container" role="application" aria-label="Calculadora">
        <div class="header">
            <div class="brand">
                <div class="logo">C</div>
                <div>
                    <div class="title">Calculadora</div>
                    <div class="subtitle">Interfaz llamativa · Soporta teclado</div>
                </div>
            </div>
            <div class="controls">
                <button id="toggleTheme" class="btn secondary" title="Alternar tema">Tema</button>
                <button id="clearAll" class="btn" title="Borrar todo">AC</button>
            </div>
        </div>

        <div class="display" aria-live="polite">
            <div class="small">
                <div class="mem-ind" id="memIndicator" aria-hidden="true" style="visibility:hidden">M</div>
                <div class="hint">Expresión</div>
            </div>
            <div class="expr" id="expression" aria-hidden="false"></div>
            <div class="result" id="result">0</div>
        </div>

        <div class="keys" role="group" aria-label="Teclado de calculadora">
            <button class="key" data-action="mc">MC</button>
            <button class="key" data-action="mr">MR</button>
            <button class="key" data-action="mplus">M+</button>
            <button class="key operator" data-action="mminus">M-</button>

            <button class="key" data-value="(">(</button>
            <button class="key" data-value=")">)</button>
            <button class="key" data-action="percent">%</button>
            <button class="key operator" data-action="divide">÷</button>

            <button class="key" data-value="7">7</button>
            <button class="key" data-value="8">8</button>
            <button class="key" data-value="9">9</button>
            <button class="key operator" data-value="*" title="Multiplicar">×</button>

            <button class="key" data-value="4">4</button>
            <button class="key" data-value="5">5</button>
            <button class="key" data-value="6">6</button>
            <button class="key operator" data-value="-" title="Restar">−</button>

            <button class="key" data-value="1">1</button>
            <button class="key" data-value="2">2</button>
            <button class="key" data-value="3">3</button>
            <button class="key operator" data-value="+" title="Sumar">+</button>

            <button class="key" data-action="sqrt">√</button>
            <button class="key" data-value="0">0</button>
            <button class="key" data-value=".">.</button>
            <button class="key equal" data-action="equals" title="Igual">=</button>
        </div>

        <div class="mini">
            <div class="hint">Usa teclado: números, + - * / ( ) . Enter = Backspace</div>
            <div><button id="toggleHistory" class="btn secondary">Historial</button></div>
        </div>

        <div id="history" class="history" hidden aria-hidden="true"></div>
    </div>

<script>
/*
    Calculadora sencilla con:
    - Evaluación segura (solo caracteres permitidos)
    - Memoria (M+, M-, MR, MC)
    - Historial
    - Soporte teclado
    - Botón raíz y porcentaje (convierte número a /100)
*/

(() => {
    const exprEl = document.getElementById('expression');
    const resEl  = document.getElementById('result');
    const keys   = document.querySelectorAll('.key');
    const histEl = document.getElementById('history');
    const toggleHistory = document.getElementById('toggleHistory');
    const clearAll = document.getElementById('clearAll');
    const memIndicator = document.getElementById('memIndicator');

    let expr = '';
    let mem = null;
    let history = [];

    function refresh(){
        exprEl.textContent = expr || '\u00A0';
        resEl.textContent = safeEvalDisplay(expr) ?? '0';
        memIndicator.style.visibility = (mem !== null) ? 'visible' : 'hidden';
        renderHistory();
    }

    function pushToHistory(equation, result){
        history.unshift({equation, result, time: new Date().toLocaleTimeString()});
        if(history.length>20) history.pop();
    }

    function renderHistory(){
        histEl.innerHTML = history.map(h => '<div class="history-item"><div><small>'+h.time+'</small><div>'+escapeHtml(h.equation)+'</div></div><div><strong>'+escapeHtml(String(h.result))+'</strong></div></div>').join('');
    }

    function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    function safeEvalDisplay(input){
        if(!input) return null;
        try{
            const v = safeEval(input);
            if (v === undefined) return null;
            // show up to 12 significant digits, remove trailing zeros
            if (!isFinite(v)) return v.toString();
            let s = Number.isInteger(v) ? String(v) : parseFloat(v.toPrecision(12)).toString();
            return s;
        } catch(e){ return 'Error' }
    }

    function safeEval(input){
        // allow digits, operators + - * / ^ . % parentheses and spaces
        if(typeof input !== 'string') throw new Error('Invalid');
        if(!/^[0-9+\-*/^().%\s]*$/.test(input)) throw new Error('Caracter no permitido');
        // Convert ^ to ** for power
        let expr = input.replace(/\^/g,'**');
        // Replace percent like "50%" -> "(50/100)"
        expr = expr.replace(/(\d+(\.\d+)?)%/g,'($1/100)');
        // Avoid leading zeros like "01" are OK
        // Finally evaluate using Function in a controlled manner
        // eslint-disable-next-line no-new-func
        const fn = new Function('return ('+expr+');');
        return fn();
    }

    function append(val){
        // prevent leading operators or malformed input
        expr += val;
        refresh();
    }

    function backspace(){
        if(!expr) return;
        expr = expr.slice(0,-1);
        refresh();
    }

    function clearAllFn(){
        expr = '';
        resEl.textContent = '0';
        refresh();
    }

    function calculate(){
        try {
            const value = safeEval(expr || '0');
            const display = (value === undefined) ? '0' : value;
            pushToHistory(expr || '0', display);
            expr = String(display);
            refresh();
        } catch(e){
            resEl.textContent = 'Error';
        }
    }

    function sqrtAction(){
        try {
            const current = expr ? safeEval(expr) : 0;
            if(current < 0) { resEl.textContent = 'NaN'; return; }
            const value = Math.sqrt(current);
            pushToHistory('√('+expr+')', value);
            expr = String(value);
            refresh();
        } catch(e){ resEl.textContent = 'Error' }
    }

    function percentAction(){
        // apply percent to current entry: interpret as number/100
        // if last token is a number, convert it to /100
        const m = expr.match(/(\d+(\.\d+)?)$/);
        if(m){
            expr = expr.slice(0, m.index) + '(' + m[0] + '/100)';
            refresh();
        }
    }

    function memoryClear(){ mem = null; refresh(); }
    function memoryRecall(){ if(mem !== null) { expr = String(mem); refresh(); } }
    function memoryAdd(){
        try {
            const v = safeEval(expr || '0');
            mem = (mem === null) ? v : mem + v;
            refresh();
        } catch(e){}
    }
    function memorySub(){
        try {
            const v = safeEval(expr || '0');
            mem = (mem === null) ? -v : mem - v;
            refresh();
        } catch(e){}
    }

    keys.forEach(k => k.addEventListener('click', e => {
        const val = k.getAttribute('data-value');
        const action = k.getAttribute('data-action');
        if(val !== null){
            append(val);
            return;
        }
        switch(action){
            case 'mc': memoryClear(); break;
            case 'mr': memoryRecall(); break;
            case 'mplus': memoryAdd(); break;
            case 'mminus': memorySub(); break;
            case 'percent': percentAction(); break;
            case 'divide': append('/'); break;
            case 'equals': calculate(); break;
            case 'sqrt': sqrtAction(); break;
            default: break;
        }
    }));

    // keyboard support
    window.addEventListener('keydown', e => {
        if(e.key.match(/^[0-9]$/)) append(e.key);
        else if(e.key === '.') append('.');
        else if(e.key === '+' || e.key === '-' || e.key === '*' || e.key === '/') append(e.key);
        else if(e.key === 'Enter' || e.key === '='){ e.preventDefault(); calculate(); }
        else if(e.key === 'Backspace'){ e.preventDefault(); backspace(); }
        else if(e.key === 'Escape'){ clearAllFn(); }
        else if(e.key === '(' || e.key === ')') append(e.key);
        else if(e.key === '^') append('^');
        // percent key: Shift+5 => %
        else if(e.key === '%') { percentAction(); }
    });

    // UI helpers
    toggleHistory.addEventListener('click', () => {
        histEl.hidden = !histEl.hidden;
        histEl.setAttribute('aria-hidden', String(histEl.hidden));
    });
    clearAll.addEventListener('click', clearAllFn);

    // small theme toggle (inverts accents)
    document.getElementById('toggleTheme').addEventListener('click', ()=>{
        document.documentElement.style.setProperty('--accent1', getComputedStyle(document.documentElement).getPropertyValue('--accent1') === '#7c5cff' ? '#ff8a5b' : '#7c5cff');
        document.documentElement.style.setProperty('--accent2', getComputedStyle(document.documentElement).getPropertyValue('--accent2') === '#00d4ff' ? '#ffc857' : '#00d4ff');
    });

    // initial render
    refresh();
})();
</script>
</body>
</html>